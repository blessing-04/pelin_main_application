<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Book Appointment - Luxe Salon</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
  </style>
</head>
<body class="bg-pink-50 text-gray-900">
  <!-- Header with Logo -->
  <header class="bg-white shadow-md py-4 px-8 flex items-center justify-between">
    <div class="flex items-center gap-4">
      <img src="media/logo.png" alt="Pelin's Logo" class="h-10 w-auto" />
    </div>
  </header>

  <!-- Booking Form Section -->
  <section class="max-w-xl mx-auto mt-12 p-8 bg-white rounded-xl shadow-lg">
    <h2 class="text-2xl font-semibold mb-6 text-center text-pink-600">Book an Appointment</h2>

    <form id="bookingForm" class="space-y-4">
      <input type="text" id="fullname" placeholder="Full Name" required class="w-full p-3 border border-gray-300 rounded-lg" />
      <input type="email" id="email" placeholder="Email Address" required class="w-full p-3 border border-gray-300 rounded-lg" />
      
      <select id="service" required class="w-full p-3 border border-gray-300 rounded-lg">
        <option value="" disabled selected>Select Service</option>
        <option value="Knotless Braids">Knotless Braids</option>
        <option value="Tribal Braids">Tribal Braids</option>
        <option value="Straight Up">Straight Up</option>
        <option value="Straight Back">Straight Back</option>
        <option value="Straight Side">Straight Side</option>
        <option value="Free Hand">Free Hand</option>
        <option value="Curly Pop">Curly Pop</option>
      </select>

      <input type="date" id="appointment_date" required class="w-full p-3 border border-gray-300 rounded-lg" />
      <input type="time" id="appointment_time" required min="09:00" max="20:00" class="w-full p-3 border border-gray-300 rounded-lg" />

      <button type="submit" class="bg-pink-600 hover:bg-pink-700 text-white py-3 px-6 rounded-lg w-full text-lg font-medium">
        Confirm Booking
      </button>
    </form>

    <p id="statusMsg" class="mt-4 text-center font-medium"></p>
  </section>

  <!-- Supabase JS -->
  <script>
  const form = document.getElementById('bookingForm');
  const statusMsg = document.getElementById('statusMsg');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const fullname = document.getElementById('fullname').value;
    const email = document.getElementById('email').value;
    const service = document.getElementById('service').value;
    const appointment_date = document.getElementById('appointment_date').value;
    const appointment_time = document.getElementById('appointment_time').value;

    const response = await fetch('https://pelins-backend.onrender.com/api/book', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        fullname,
        email,
        service,
        appointment_date,
        appointment_time
      })
    });

    const result = await response.json();

    if (!response.ok) {
      statusMsg.textContent = `❌ ${result.error || 'Booking failed'}`;
      statusMsg.className = 'text-red-600 text-center mt-4';
    } else {
      statusMsg.textContent = '✅ Appointment booked successfully!';
      statusMsg.className = 'text-green-600 text-center mt-4';
      form.reset();
    }
  });

  document.addEventListener('DOMContentLoaded', () => {
    const dateInput = document.getElementById('appointment_date');
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    const minDate = `${yyyy}-${mm}-${dd}`;
    dateInput.min = minDate;
  });
</script>

</body>
</html>
